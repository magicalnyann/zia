<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <title>ì¥ë°”êµ¬ë‹ˆ</title>
   <link rel="stylesheet" type="text/css" href="/css/cart.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
   <div id="logo">
      <img src="../images/foomain.jpg" alt="ë©”ì¸ë¡œê³ ">
   </div>
   <h1><span id="memberName"></span>ì˜ ì¥ë°”êµ¬ë‹ˆ ğŸ›’ </h1>

   <div class="address-box">
      <h2>ë°°ì†¡ì£¼ì†Œ ğŸ  </h2>
      <p id="memberAddr1"></p>
      <p id="memberAddr2"></p>
      <p id="memberAddr3"></p>
      í˜¹ì‹œ ì´ ì£¼ì†Œê°€ ì•„ë‹Œê°€ìš”? <button onclick="changeAddress()">ë°°ì†¡ì£¼ì†Œ ë³€ê²½í•˜ê¸°</button>
   </div>

   <script>
      function changeAddress() {
         new daum.Postcode({
            oncomplete: function (data) {
               document.getElementById('memberAddr1').value = data.zonecode;
               document.getElementById('memberAddr2').value = data.roadAddress;
               document.getElementById('memberAddr3').value = data.jibunAddress;
            }
         }).open();
      }
   </script>

   <script>
      $(document).ready(function () {
         $.ajax({
            type: 'GET',
            url: '/user/cartinfo',
            dataType: 'json',

            success: function (response) {
               console.log('íšŒì› ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤:', response);

               $('#memberName').text(response.memberName);
               $('#memberAddr1').text(response.memberAddr1);
               $('#memberAddr2').text(response.memberAddr2);
               $('#memberAddr3').text(response.memberAddr3);
            },
            error: function () {
               console.error('íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
         });
      });
   </script>


   <div id="cartItems">
      <div th:each="product : ${cart}">
         <img th:src="${product.imagePath}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
         <p>ìƒí’ˆëª…: <span th:text="${product.name}"></span></p>
         <p th:if="${product.discountPrice != null}">
            í• ì¸ ê°€ê²©: <span th:text="${product.discount}"></span></p>
         <p th:unless="${product.discount!= null}">
            ê°€ê²©: <span th:text="${product.price}"></span>
         </p>

      </div>
   </div>




<h1>ì£¼ë¬¸ì„œ</h1>   

   <div id="paymentMethods">
      <label for="cardSelect">ì¹´ë“œì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</label>
      <select id="cardSelect">
         <option value="visa">Visa</option>
         <option value="mastercard">Mastercard</option>
         <option value="amex">American Express</option>
         <option value="discover">Discover</option>
      </select>
   </div>

   <script>
      $('#cardSelect').change(function () {
         var selectedCard = $(this).val();
         console.log('ì„ íƒëœ ì¹´ë“œ:', selectedCard);
      });
   </script>

   <div id="depositBox">
      <label for="depositInput">ì˜ˆì¹˜ê¸ˆ</label>
      <input type="text" id="depositInput" placeholder="ì˜ˆì¹˜ê¸ˆì„ ì…ë ¥í•˜ì„¸ìš”" />
      <span>dallars</span>
      <label><input type="checkbox" id="depositAll"> ì „ë¶€ ì“°ê¸°</label>
   </div>
   <div id="balanceBox">
      <label for="balanceInput">Balance</label>
      <input type="text" id="balanceInput" th:value="${balance}" disabled />
      <span>dallars</span>
   </div>

   <script th:inline="javascript">
      /*<![CDATA[*/
      $(document).ready(function () {
         $('#depositInput').change(function () {
            var deposit = $(this).val();
            if (deposit !== '') {
               $('#balanceInput').val(deposit);
            }
         });

         $('#depositAll').change(function () {
            var deposit = $('#depositInput').val();
            if ($(this).is(':checked') && deposit !== '') {
               $('#balanceInput').val(deposit);
            }
         });
      });
    /*]]>*/
   </script>


   <script>
      $(document).ready(function () {
         $('#orderButton').prop('disabled', true);
         $('#agreePrivacy, #agreeTerms').change(function () { 
            if ($('#agreePrivacy').prop('checked') && $('#agreeTerms').prop('checked')) {
               $('#orderButton').prop('disabled', false);
            } else {             
               $('#orderButton').prop('disabled', true);
            }
         });
      });

      function calculateTotal() {
         var totalPrice = 0;
         var totalDiscount = 0;
         var totalDeposit = parseFloat(document.getElementById('depositInput').value);
         var totalPoint = parseFloat(document.getElementById('pointInput').value);
        
         $('#cartItems .product').each(function () {
            var price = parseFloat($(this).find('.price').text());
            var discount = parseFloat($(this).find('.discount').text());

            totalPrice += price;
            totalDiscount += discount;
         });

         var totalAmount = totalPrice - totalDiscount - totalDeposit - totalPoint;

         document.getElementById('totalPrice').textContent = totalPrice.toFixed(2) + ' ì–´ì©Œê³ '; 
         document.getElementById('totalDiscount').textContent = totalDiscount.toFixed(2) + ' discount '; 
         document.getElementById('totalDeposit').textContent = totalDeposit.toFixed(2) + ' dollars'; 
         document.getElementById('totalPoint').textContent = totalPoint.toFixed(2) + ' dollars'; 
         document.getElementById('totalAmount').textContent = totalAmount.toFixed(2) + ' total amount ì–´ì©Œê³ '; 
      }

      $(document).ready(function () {
         calculateTotal();
      });
      <button id="orderButton"> ì£¼ë¬¸í•˜ê¸°</button>
   </script>
   
<script>
	function placeOrder() {
    // ì£¼ë¬¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ (ì˜ˆ: ì¥ë°”êµ¬ë‹ˆì—ì„œ ì„ íƒëœ ìƒí’ˆ ì •ë³´)
    var orderData = {
        // ì£¼ë¬¸ ì •ë³´ë¥¼ ì±„ì›Œë„£ìŠµë‹ˆë‹¤.
    };

    // AJAXë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ì— ì£¼ë¬¸ì„ ì „ì†¡í•©ë‹ˆë‹¤.
    $.ajax({
        type: "POST",
        url: "/shop/order",
        contentType: "application/json",
        data: JSON.stringify(orderData),
        success: function(response) {
            console.log("ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        },
        error: function(xhr, status, error) {
            console.error("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    });
}
	</script>
   
   
   
   
   
   
   
</body>
</html>