
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>ì¥ë°”êµ¬ë‹ˆ</title>
	<link rel="stylesheet" type="text/css" href="/css/cart.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>

	<div id="logo">
		<img src="../images/foomain.jpg" alt="ë©”ì¸ë¡œê³ ">
	</div>

	<h1><span id="memberName"></span>ì˜ ì¥ë°”êµ¬ë‹ˆ ğŸ›’ </h1>

	<div class="address-box">
		<h2>ë°°ì†¡ì£¼ì†Œ ğŸ  </h2>
		<p id="memberAddr1" th:text="${memberAddr1}"></p>
		<p id="memberAddr2" th:text="${memberAddr2}"></p>
		<p id="memberAddr3" th:text="${memberAddr3}"></p>
	</div>

	<script>
		$(document).ready(function () {
			$.ajax({
				type: 'GET',
				url: '/shop/cartinfo',
				dataType: 'json',
				success: function (response) {
					console.log('íšŒì› ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤:', response);

					$('#memberName').text(response.memberName);
					$('#memberAddr1').text(response.memberAddr1);
					$('#memberAddr2').text(response.memberAddr2);
					$('#memberAddr3').text(response.memberAddr3);

				},
				error: function () {
					console.error('íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				}
			});
		}); 
	</script>

	<table>

		<caption style="visibility: hidden;">ìƒí’ˆ ì •ë³´</caption>
		<thead style="display: none;">
			<tr>
				<th>ì´ë¯¸ì§€</th>
				<th>ìƒí’ˆëª…</th>
				<th>ê°€ê²©</th>
				<th>í• ì¸</th>
				<th>ì¬ê³ </th>
				<th>ì‹œì‘ì¼</th>
			</tr>
		</thead>
		<tbody>
			<th:block th:each="product : ${list}">
				<tr>
					<td><input type="checkbox" class="product-checkbox"></td>
					<td><img th:src="${product.imagePath}" alt="ìƒí’ˆ ì´ë¯¸ì§€"></td>
					<td th:text="${product.pname}"></td>
					<td th:text="${product.price}"></td>
					<td th:text="${product.discount}" class="red-text"></td>
					<td th:text="${product.stock}"></td>
					<td th:text="${product.startDate}"></td>
				</tr>
			</th:block>
		</tbody>
	</table>

	<h1>ì£¼ë¬¸ì„œ</h1>
	<div class="money-container">
		<div>
			<label for="memberMoney">ì˜ˆì¹˜ê¸ˆ</label>
			<p id="memberMoney" th:text="${memberMoney}">ì› ë‚¨ì•˜ì–´ìš”</p>
			<input type="number" id="useMoney" name="useMoney" placeholder="ì‚¬ìš©í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”">
		</div>
	</div>

	<div class="point-container">
		<div>
			<label for="memberPoint">í¬ì¸íŠ¸</label>
			<p id="memberPoint" th:text="${memberPoint}">ì› ë‚¨ì•˜ì–´ìš”</p>
			<input type="number" id="usePoint" name="usePoint" placeholder="ì‚¬ìš©í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”">
		</div>
	</div>

	<script>
		$(document).ready(function () {
			$.ajax({
				type: 'GET',
				url: '/shop/moneyinfo',
				dataType: 'json',
				success: function (response) {
					console.log('íšŒì› ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤:', response);
					$('#memberMoney').text(response.money + 'ì› ë‚¨ì•˜ì–´ìš”');
					$('#memberPoint').text(response.point + 'ì› ë‚¨ì•˜ì–´ìš”');
				},
				error: function () {
					console.error('íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				}
			});
		});
	</script>
	
<script>
    $(document).ready(function () {
        $(".product-checkbox").click(function () {
            var totalAmount = 0;
            $(".product-checkbox:checked").each(function () {
                var price = parseInt($(this).closest("tr").find("td:eq(3)").text());
                var discount = parseInt($(this).closest("tr").find("td:eq(4)").text());
                totalAmount += (price + discount);
            });

            $("#totalAmount").text(totalAmount + "ì›");
        });

        $("#orderButton").click(function () {
            var totalAmount = 0;
            $(".product-checkbox:checked").each(function () {
                var price = parseInt($(this).closest("tr").find("td:eq(3)").text());
                var discount = parseInt($(this).closest("tr").find("td:eq(4)").text());
                totalAmount += (price - discount);
            });

            var useMoney = parseInt($("#useMoney").val());
            var usePoint = parseInt($("#usePoint").val());

            var orderData = {
                totalAmount: totalAmount,
                useMoney: useMoney,
                usePoint: usePoint
            };

            $.ajax({
                type: "POST",
                url: "/shop/order",
                data: orderData,
                success: function (response) {
                    window.location.href = "/shop/zoomoonOk";
                },
                error: function (xhr, status, error) {
                    if (xhr.status === 405) {
                        alert("ì„œë²„ì—ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
                    } else {
                        alert("ì£¼ë¬¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    }
                }
            });
        }); 
    });
</script>

	<div id="totalAmountContainer">
		<label for="totalAmount">ì´ ì£¼ë¬¸ ê¸ˆì•¡</label>
		<p id="totalAmount">0ì›</p>
	</div>

	<button id="orderButton" type="submit">ì£¼ë¬¸í•˜ê¸°</button>
</body>
</html>